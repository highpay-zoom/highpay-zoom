<!DOCTYPE html>
<!-- saved from url=(0044)http://www.cnblogs.com/paddix/p/5309550.html -->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园</title>
<link type="text/css" rel="stylesheet" href="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/blog-common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/bundle-CodingLife.css">
<link id="mobile-style" media="only screen and (max-width: 768px)" type="text/css" rel="stylesheet" href="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/bundle-CodingLife-mobile.css">
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/paddix/rss">
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/paddix/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/paddix/wlwmanifest.xml">
<script src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/jquery.js.下载" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'paddix', cb_enable_mathjax=false;var isLogined=false;</script>
<script src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/blog-common.js.下载" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>

<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a id="lnkBlogLogo" href="http://www.cnblogs.com/paddix/"><img id="blogLogo" src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/logo.gif" alt="返回主页"></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/paddix/">liuxiaopeng</a></h1>
<h2></h2>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="http://www.cnblogs.com/">博客园</a></li>
<li><a id="blog_nav_myhome" class="menu" href="http://www.cnblogs.com/paddix/">首页</a></li>
<li><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/liuxiaopeng">联系</a></li>
<li><a id="blog_nav_rss" class="menu" href="http://www.cnblogs.com/paddix/rss">订阅</a>
<!--<a id="blog_nav_rss_image" class="aHeaderXML" href="http://www.cnblogs.com/paddix/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>
		<div class="blogStats">
			
			<div id="blog_stats">
<span id="stats_post_count">随笔 - 11&nbsp; </span>
<span id="stats_article_count">文章 - 0&nbsp; </span>
<span id="stats-comment_count">评论 - 42</span>
</div>
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/paddix/p/5309550.html">Java8内存模型—永久代(PermGen)和元空间(Metaspace)</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><p><span style="font-size: 14pt;"><strong>一、JVM 内存模型</strong></span></p>
<p>　　根据 JVM 规范，JVM 内存共分为虚拟机栈、堆、方法区、程序计数器、本地方法栈五个部分。</p>
<p><img style="width: 600px; height: 320px;" src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/820406-20160326200119386-756216654.png" alt=""></p>
<p align="left">　　1、虚拟机栈：每个线程有一个私有的栈，随着线程的创建而创建。栈里面存着的是一种叫“栈帧”的东西，每个方法会创建一个栈帧，栈帧中存放了局部变量表（基本数据类型和对象引用）、操作数栈、方法出口等信息。栈的大小可以固定也可以动态扩展。当栈调用深度大于JVM所允许的范围，会抛出StackOverflowError的错误，不过这个深度范围不是一个恒定的值，我们通过下面这段程序可以测试一下这个结果：</p>
<p align="left">栈溢出测试源码：</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_545582" class="syntaxhighlighter  java"><div class="toolbar"><span><a href="http://www.cnblogs.com/paddix/p/5309550.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.paddx.test.memory;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">StackErrorMock {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">int</code> <code class="java plain">index = </code><code class="java value">1</code><code class="java plain">;</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">call(){</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">index++;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">call();</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">main(String[] args) {</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">StackErrorMock mock = </code><code class="java keyword">new</code> <code class="java plain">StackErrorMock();</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mock.call();</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code><code class="java keyword">catch</code> <code class="java plain">(Throwable e){</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">System.out.println(</code><code class="java string">"Stack deep : "</code><code class="java plain">+index);</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">e.printStackTrace();</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number20 index19 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p style="text-align: center;">代码段 1</p>
<p>运行三次，可以看出每次栈的深度都是不一样的，<span style="line-height: 1.5;">输出结果如下</span><span style="line-height: 1.5;">。</span></p>
<p><img style="width: 800px; height: 450px;" src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/820406-20160326203208120-2065530115.png" alt=""></p>
<p><span style="line-height: 1.5;">至于红色框里的值是怎么出来的，就需要深入到 JVM 的源码中才能探讨，这里不作详细阐述。</span></p>
<p>虚拟机栈除了上述错误外，还有另一种错误，那就是当申请不到空间时，会抛出 OutOfMemoryError。这里有一个小细节需要注意，catch 捕获的是&nbsp;Throwable，而不是 Exception。因为&nbsp;StackOverflowError 和 OutOfMemoryError 都不属于 Exception 的子类。</p>
<p>　　2、本地方法栈：</p>
<p>　　这部分主要与虚拟机用到的 Native 方法相关，一般情况下， Java 应用程序员并不需要关心这部分的内容。</p>
<p>　　3、PC 寄存器：</p>
<p>　　PC 寄存器，也叫程序计数器。JVM支持多个线程同时运行，每个线程都有自己的程序计数器。倘若当前执行的是 JVM 的方法，则该寄存器中保存当前执行指令的地址；倘若执行的是native 方法，则PC寄存器中为空。</p>
<p>　　4、堆</p>
<p>　　堆内存是 JVM 所有线程共享的部分，在虚拟机启动的时候就已经创建。所有的对象和数组都在堆上进行分配。这部分空间可通过 GC 进行回收。当申请不到空间时会抛出 OutOfMemoryError。下面我们简单的模拟一个堆内存溢出的情况：</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_26646" class="syntaxhighlighter  java"><div class="toolbar"><span><a href="http://www.cnblogs.com/paddix/p/5309550.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.paddx.test.memory;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java plain">java.util.ArrayList;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java plain">java.util.List;</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">HeapOomMock {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">main(String[] args) {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">List&lt;</code><code class="java keyword">byte</code><code class="java plain">[]&gt; list = </code><code class="java keyword">new</code> <code class="java plain">ArrayList&lt;</code><code class="java keyword">byte</code><code class="java plain">[]&gt;();</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">i = </code><code class="java value">0</code><code class="java plain">;</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">boolean</code> <code class="java plain">flag = </code><code class="java keyword">true</code><code class="java plain">;</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">while</code> <code class="java plain">(flag){</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">i++;</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">list.add(</code><code class="java keyword">new</code> <code class="java keyword">byte</code><code class="java plain">[</code><code class="java value">1024</code> <code class="java plain">* </code><code class="java value">1024</code><code class="java plain">]);</code><code class="java comments">//每次增加一个1M大小的数组对象</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code><code class="java keyword">catch</code> <code class="java plain">(Throwable e){</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">e.printStackTrace();</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">flag = </code><code class="java keyword">false</code><code class="java plain">;</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">System.out.println(</code><code class="java string">"count="</code><code class="java plain">+i);</code><code class="java comments">//记录运行的次数</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number22 index21 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p style="text-align: center;">代码段 2</p>
<p>运行上述代码，输出结果如下：　　</p>
<p><img style="width: 800px; height: 110px;" src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/820406-20160326193901979-647552717.png" alt="">　　　</p>
<p><span style="color: #ff0000;">注意，这里我指定了堆内存的大小为16M，所以这个地方显示的count=14（这个数字不是固定的），至于为什么会是14或其他数字，需要根据 GC 日志来判断，具体原因会在下篇文章中给大家解释。</span></p>
<p><span style="color: #ff0000;">　　<span style="color: #000000;">5、</span><span style="color: #000000;">方法区：</span></span></p>
<p><span style="color: #000000;">　　方法区也是所有线程共享。主要用于存储类的信息、常量池、方法数据、方法代码等。方法区逻辑上属于堆的一部分，但是为了与堆进行区分，通常又叫“非堆”。 关于方法区内存溢出的问题会在下文中详细探讨。</span></p>
<p><span style="font-size: 14pt;"><strong>二、PermGen（永久代）</strong></span></p>
<p>　　绝大部分 Java 程序员应该都见过 "java.lang.OutOfMemoryError:&nbsp;PermGen&nbsp;space&nbsp;"这个异常。这里的 “PermGen space”其实指的就是方法区。不过方法区和“PermGen space”又有着本质的区别。前者是 JVM 的规范，而后者则是 JVM 规范的一种实现，并且只有 HotSpot 才有&nbsp;“PermGen space”，而对于其他类型的虚拟机，如 JRockit（Oracle）、J9（IBM） 并没有“PermGen space”。由于方法区主要存储类的相关信息，所以对于动态生成类的情况比较容易出现永久代的内存溢出。最典型的场景就是，在 jsp 页面比较多的情况，容易出现永久代内存溢出。我们现在通过动态生成类来模拟 “PermGen&nbsp;space”的内存溢出：</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_876574" class="syntaxhighlighter  java"><div class="toolbar"><span><a href="http://www.cnblogs.com/paddix/p/5309550.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.paddx.test.memory;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">Test {</code></div><div class="line number4 index3 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p style="text-align: center;">&nbsp;代码段 3</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_23869" class="syntaxhighlighter  java"><div class="toolbar"><span><a href="http://www.cnblogs.com/paddix/p/5309550.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.paddx.test.memory;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java plain">java.io.File;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java plain">java.net.URL;</code></div><div class="line number5 index4 alt2"><code class="java keyword">import</code> <code class="java plain">java.net.URLClassLoader;</code></div><div class="line number6 index5 alt1"><code class="java keyword">import</code> <code class="java plain">java.util.ArrayList;</code></div><div class="line number7 index6 alt2"><code class="java keyword">import</code> <code class="java plain">java.util.List;</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">PermGenOomMock{</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">main(String[] args) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">URL url = </code><code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">List&lt;ClassLoader&gt; classLoaderList = </code><code class="java keyword">new</code> <code class="java plain">ArrayList&lt;ClassLoader&gt;();</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">url = </code><code class="java keyword">new</code> <code class="java plain">File(</code><code class="java string">"/tmp"</code><code class="java plain">).toURI().toURL();</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">URL[] urls = {url};</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">while</code> <code class="java plain">(</code><code class="java keyword">true</code><code class="java plain">){</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ClassLoader loader = </code><code class="java keyword">new</code> <code class="java plain">URLClassLoader(urls);</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">classLoaderList.add(loader);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">loader.loadClass(</code><code class="java string">"com.paddx.test.memory.Test"</code><code class="java plain">);</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(Exception e) {</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">e.printStackTrace();</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number25 index24 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p style="text-align: center;">代码段 4</p>
<p>运行结果如下：</p>
<p><img style="width: 800px; height: 300px;" src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/820406-20160327005846979-1124627174.png" alt=""></p>
<p>　　本例中使用的 JDK 版本是 1.7，指定的 PermGen 区的大小为 8M。通过每次生成不同URLClassLoader对象来加载Test类，从而生成不同的类对象，这样就能看到我们熟悉的&nbsp;"java.lang.OutOfMemoryError:&nbsp;PermGen&nbsp;space&nbsp;" 异常了。这里之所以采用 JDK 1.7，是因为在 JDK 1.8 中， HotSpot 已经没有 “PermGen space”这个区间了，取而代之是一个叫做 Metaspace（元空间） 的东西。下面我们就来看看 Metaspace 与 PermGen space 的区别。</p>
<p><span style="font-size: 14pt;"><strong>三、Metaspace（元空间）</strong></span></p>
<p>　　其实，移除永久代的工作从JDK1.7就开始了。JDK1.7中，存储在永久代的部分数据就已经转移到了Java Heap或者是 Native Heap。但永久代仍存在于JDK1.7中，并没完全移除，譬如符号引用(Symbols)转移到了native heap；字面量(interned strings)转移到了java heap；类的静态变量(class statics)转移到了java heap。我们可以通过一段程序来比较 JDK 1.6 与 JDK 1.7及 JDK 1.8 的区别，以字符串常量为例：</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_132179" class="syntaxhighlighter  java"><div class="toolbar"><span><a href="http://www.cnblogs.com/paddix/p/5309550.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">com.paddx.test.memory;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java plain">java.util.ArrayList;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java plain">java.util.List;</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">StringOomMock {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">static</code> <code class="java plain">String&nbsp; base = </code><code class="java string">"string"</code><code class="java plain">;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">main(String[] args) {</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">List&lt;String&gt; list = </code><code class="java keyword">new</code> <code class="java plain">ArrayList&lt;String&gt;();</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">for</code> <code class="java plain">(</code><code class="java keyword">int</code> <code class="java plain">i=</code><code class="java value">0</code><code class="java plain">;i&lt; Integer.MAX_VALUE;i++){</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String str = base + base;</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">base = str;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">list.add(str.intern());</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number16 index15 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>这段程序以2的指数级不断的生成新的字符串，这样可以比较快速的消耗内存。我们通过 JDK 1.6、JDK 1.7 和 JDK 1.8 分别运行：</p>
<p>JDK 1.6 的运行结果：</p>
<p><img style="width: 800px; height: 160px;" src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/820406-20160327005929386-409283462.png" alt=""></p>
<p>JDK 1.7的运行结果：</p>
<p><img style="width: 800px; height: 200px;" src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/820406-20160327010033823-1341228280.png" alt=""></p>
<p>JDK 1.8的运行结果：</p>
<p><img style="width: 800px; height: 230px;" src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/820406-20160327010143776-1612977566.png" alt=""></p>
<p>　　从上述结果可以看出，JDK 1.6下，会出现“PermGen Space”的内存溢出，而在 JDK 1.7和 JDK 1.8 中，会出现堆内存溢出，并且 JDK 1.8中 PermSize 和 MaxPermGen 已经无效。因此，可以大致验证 JDK 1.7 和 1.8 将字符串常量由永久代转移到堆中，并且 JDK 1.8 中已经不存在永久代的结论。现在我们看看元空间到底是一个什么东西？</p>
<p>　　元空间的本质和永久代类似，都是对JVM规范中方法区的实现。不过元空间与永久代之间最大的区别在于：元空间并不在虚拟机中，而是使用本地内存。因此，默认情况下，元空间的大小仅受本地内存限制，但可以通过以下参数来指定元空间的大小：</p>
<p>　　-XX:MetaspaceSize，初始空间大小，达到该值就会触发垃圾收集进行类型卸载，同时GC会对该值进行调整：如果释放了大量的空间，就适当降低该值；如果释放了很少的空间，那么在不超过MaxMetaspaceSize时，适当提高该值。<br>　　-XX:MaxMetaspaceSize，最大空间，默认是没有限制的。</p>
<p>　　除了上面两个指定大小的选项以外，还有两个与 GC 相关的属性：<br>　　-XX:MinMetaspaceFreeRatio，在GC之后，最小的Metaspace剩余空间容量的百分比，减少为分配空间所导致的垃圾收集<br>　　-XX:MaxMetaspaceFreeRatio，在GC之后，最大的Metaspace剩余空间容量的百分比，减少为释放空间所导致的垃圾收集</p>
<p>现在我们在 JDK 8下重新运行一下代码段 4，不过这次不再指定 PermSize 和 MaxPermSize。而是指定 MetaSpaceSize 和 MaxMetaSpaceSize的大小。输出结果如下：</p>
<p><img style="width: 800px; height: 300px;" src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/820406-20160327010233933-699106123.png" alt=""></p>
<p>从输出结果，我们可以看出，这次不再出现永久代溢出，而是出现了元空间的溢出。</p>
<p><span style="font-size: 14pt;"><strong>四、总结</strong></span></p>
<p><span style="font-size: 18pt;"><strong>　</strong><span style="font-size: 16px;">　<span style="font-size: 14px;">通过上面分析，大家应该大致了解了 JVM 的内存划分，也清楚了 JDK 8 中永久代向元空间的转换。不过大家应该都有一个疑问，就是为什么要做这个转换？所以，最后给大家总结以下几点原因：<br></span></span></span></p>
<p><span style="font-size: 18pt;"><span style="font-size: 16px;"><span style="font-size: 14px;">　　1、字符串存在永久代中，容易出现性能问题和内存溢出。</span></span></span></p>
<p><span style="font-size: 18pt;"><span style="font-size: 16px;"><span style="font-size: 14px;">　　2、类及方法的信息等比较难确定其大小，因此对于永久代的大小指定比较困难，太小容易出现永久代溢出，太大则容易导致老年代溢出。</span></span></span></p>
<p><span style="font-size: 18pt;"><span style="font-size: 16px;"><span style="font-size: 14px;">　　3、永久代会为 GC 带来不必要的复杂度，并且回收效率偏低。</span></span></span></p>
<p><span style="font-size: 18pt;"><span style="font-size: 16px;"><span style="font-size: 14px;">　　4、Oracle 可能会将HotSpot 与 JRockit 合二为一。</span></span></span></p></div><div id="MySignature" style="display: block;"><div style="background: #FBFEFF; padding: 15px 10px; border: 1px dashed #886d0d; font-family: 微软雅黑;">
<p style="padding-bottom: 5px">&nbsp;作者：<a href="http://www.cnblogs.com/paddix">liuxiaopeng</a></p>

 <p style="padding-bottom: 5px">&nbsp;博客地址：<a href="http://www.cnblogs.com/paddix">http://www.cnblogs.com/paddix/ </a></p>                

 <p style="padding-bottom: 5px">&nbsp;声明：转载请在文章页面明显位置给出原文连接。&nbsp;</p>
</div></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag">标签: <a href="http://www.cnblogs.com/paddix/tag/JVM/">JVM</a>, <a href="http://www.cnblogs.com/paddix/tag/%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">内存模型</a></div>
<div id="blog_post_info"><div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(5309550,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
            <a id="green_channel_follow" onclick="follow(&#39;1b38d60f-7e6e-e511-9fc1-ac853d9f53cc&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/paddix/" target="_blank"><img src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/20160405085105.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/paddix/">liuxiaopeng</a><br>
            <a href="http://home.cnblogs.com/u/paddix/followees">关注 - 2</a><br>
            <a href="http://home.cnblogs.com/u/paddix/followers">粉丝 - 77</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow(&#39;1b38d60f-7e6e-e511-9fc1-ac853d9f53cc&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(5309550,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">3</span>
    </div>
    <div class="buryit" onclick="votePost(5309550,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>
</div>
<div class="clear"></div>
<div id="post_next_prev"><a href="http://www.cnblogs.com/paddix/p/5282004.html" class="p_n_p_prefix">« </a> 上一篇：<a href="http://www.cnblogs.com/paddix/p/5282004.html" title="发布于2016-03-21 02:40">从字节码层面看“HelloWorld”</a><br><a href="http://www.cnblogs.com/paddix/p/5326863.html" class="p_n_p_prefix">» </a> 下一篇：<a href="http://www.cnblogs.com/paddix/p/5326863.html" title="发布于2016-04-05 08:28">通过反编译深入理解Java String及intern</a><br></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2016-03-27 01:04</span> <a href="http://www.cnblogs.com/paddix/">liuxiaopeng</a> 阅读(<span id="post_view_count">2397</span>) 评论(<span id="post_comment_count">1</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=5309550" rel="nofollow">编辑</a> <a href="http://www.cnblogs.com/paddix/p/5309550.html#" onclick="AddToWz(5309550);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=248333,cb_entryId=5309550,cb_blogApp=currentBlogApp,cb_blogUserGuid='1b38d60f-7e6e-e511-9fc1-ac853d9f53cc',cb_entryCreatedDate='2016/3/27 1:04:00';loadViewCount(cb_entryId);</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"><div id="comments_pager_top"></div>
<br>
<div class="feedback_area_title">评论列表</div>
<div class="feedbackNoItems"></div>	

		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/paddix/p/5309550.html#3430578" class="layer">#1楼</a><a name="3430578" id="comment_anchor_3430578"></a><span id="comment-maxId" style="display:none;">3430578</span><span id="comment-maxDate" style="display:none;">2016/5/13 15:11:12</span>  <span class="comment_date">2016-05-13 15:11</span> <a id="a_comment_author_3430578" href="http://www.cnblogs.com/zhengbin/" target="_blank">郑州的文武</a> <a href="http://msg.cnblogs.com/send/%E9%83%91%E5%B7%9E%E7%9A%84%E6%96%87%E6%AD%A6" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3430578" class="blog_comment_body">博主写的都挺好的，关注~</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3430578,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3430578,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3430578_avatar" style="display:none;">http://pic.cnblogs.com/face/731716/20150316143550.png</span>
			</div>
		</div>
	<div id="comments_pager_bottom"></div></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="http://www.cnblogs.com/paddix/p/5309550.html#" onclick="return RefreshPage();">刷新页面</a><a href="http://www.cnblogs.com/paddix/p/5309550.html#top">返回顶部</a></div>
<div id="comment_form_container"><div class="login_tips">注册用户登录后才能发表评论，请 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login(&#39;commentform&#39;);">登录</a> 或 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，<a href="http://www.cnblogs.com/">访问</a>网站首页。</div></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"></div>
<div id="opt_under_post"></div>
<div id="ad_c1" class="c_ad_block"><a href="http://www.gcpowertools.com.cn/products/spreadjs/?utm_source=cnblogs&amp;utm_medium=blogpage&amp;utm_term=bottom&amp;utm_content=SpreadJS&amp;utm_campaign=community" target="_blank"><img width="300" height="250" src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/24442-20161031104652361-1905759806.gif" alt=""></a></div>
<div id="under_post_news"><div class="itnews c_ad_block"><b>最新IT新闻</b>:<br> ·  <a href="http://news.cnblogs.com/n/557674/" target="_blank">微软也要做自己的“Touch Bar”? 新专利竟是个中文输入神器</a><br> ·  <a href="http://news.cnblogs.com/n/557673/" target="_blank">5分钟回顾Linux 25年的发展历程与变迁</a><br> ·  <a href="http://news.cnblogs.com/n/557672/" target="_blank">Visual Studio Code 1.7.2发布</a><br> ·  <a href="http://news.cnblogs.com/n/557671/" target="_blank">恶意视频链接会导致任何iOS设备死机</a><br> ·  <a href="http://news.cnblogs.com/n/557670/" target="_blank">如何把女儿培养成萌萌哒萝莉程序员</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div></div>
<div id="ad_c2" class="c_ad_block"><a href="https://www.jiguang.cn/devservice/?from=cnblogs01" target="_blank"><img width="468" height="60" src="./Java8内存模型—永久代(PermGen)和元空间(Metaspace) - liuxiaopeng - 博客园_files/24442-20161114133622451-1554357151.jpg" alt=""></a></div>
<div id="under_post_kb"><div class="itnews c_ad_block" id="kb_block"><b>最新知识库文章</b>:<br><div id="kb_recent"> ·  <a href="http://kb.cnblogs.com/page/555750/" target="_blank">循序渐进地代码重构</a><br> ·  <a href="http://kb.cnblogs.com/page/554496/" target="_blank">技术的正宗与野路子</a><br> ·  <a href="http://kb.cnblogs.com/page/553682/" target="_blank">陈皓：什么是工程师文化？</a><br> ·  <a href="http://kb.cnblogs.com/page/551422/" target="_blank">没那么难，谈CSS的设计模式</a><br> ·  <a href="http://kb.cnblogs.com/page/550625/" target="_blank">程序猿媳妇儿注意事项</a><br></div>» <a href="http://kb.cnblogs.com/" target="_blank">更多知识库文章...</a></div></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"><div id="profile_block">昵称：<a href="http://home.cnblogs.com/u/paddix/">liuxiaopeng</a><br>园龄：<a href="http://home.cnblogs.com/u/paddix/" title="入园时间：2015-10-09">1年1个月</a><br>粉丝：<a href="http://home.cnblogs.com/u/paddix/followers/">77</a><br>关注：<a href="http://home.cnblogs.com/u/paddix/followees/">2</a><div id="p_b_follow"><a href="javascript:void(0);" onclick="follow(&#39;1b38d60f-7e6e-e511-9fc1-ac853d9f53cc&#39;)">+加关注</a></div></div></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="blog-calendar" style=""><table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="日历">
	<tbody><tr><td colspan="7"><table class="CalTitle" cellspacing="0">
		<tbody><tr><td class="CalNextPrev"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2016/10/01&#39;);return false;">&lt;</a></td><td align="center">2016年11月</td><td class="CalNextPrev" align="right"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2016/12/01&#39;);return false;">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" align="center" abbr="日" scope="col">日</th><th class="CalDayHeader" align="center" abbr="一" scope="col">一</th><th class="CalDayHeader" align="center" abbr="二" scope="col">二</th><th class="CalDayHeader" align="center" abbr="三" scope="col">三</th><th class="CalDayHeader" align="center" abbr="四" scope="col">四</th><th class="CalDayHeader" align="center" abbr="五" scope="col">五</th><th class="CalDayHeader" align="center" abbr="六" scope="col">六</th></tr><tr><td class="CalOtherMonthDay" align="center">30</td><td class="CalOtherMonthDay" align="center">31</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">4</td><td class="CalWeekendDay" align="center">5</td></tr><tr><td class="CalWeekendDay" align="center">6</td><td align="center">7</td><td align="center">8</td><td align="center">9</td><td align="center">10</td><td align="center">11</td><td class="CalWeekendDay" align="center">12</td></tr><tr><td class="CalWeekendDay" align="center">13</td><td align="center">14</td><td align="center">15</td><td align="center">16</td><td align="center">17</td><td align="center">18</td><td class="CalWeekendDay" align="center">19</td></tr><tr><td class="CalWeekendDay" align="center">20</td><td align="center">21</td><td align="center">22</td><td class="CalTodayDay" align="center">23</td><td align="center">24</td><td align="center">25</td><td class="CalWeekendDay" align="center">26</td></tr><tr><td class="CalWeekendDay" align="center">27</td><td align="center">28</td><td align="center">29</td><td align="center">30</td><td class="CalOtherMonthDay" align="center">1</td><td class="CalOtherMonthDay" align="center">2</td><td class="CalOtherMonthDay" align="center">3</td></tr><tr><td class="CalOtherMonthDay" align="center">4</td><td class="CalOtherMonthDay" align="center">5</td><td class="CalOtherMonthDay" align="center">6</td><td class="CalOtherMonthDay" align="center">7</td><td class="CalOtherMonthDay" align="center">8</td><td class="CalOtherMonthDay" align="center">9</td><td class="CalOtherMonthDay" align="center">10</td></tr>
</tbody></table></div><script type="text/javascript">loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><div id="sidebar_search" class="sidebar-block">
<div id="sidebar_search" class="mySearch">
<h3 class="catListTitle">搜索</h3>
<div id="sidebar_search_box">
<div id="widget_my_zzk" class="div_my_zzk"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk"></div>
<div id="widget_my_google" class="div_my_zzk"><input type="text" name="google_q" id="google_q" onkeydown="return google_go_enter(event)" class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button" value="谷歌搜索" class="btn_my_zzk"></div>
</div>
</div>

</div><div id="sidebar_shortcut" class="sidebar-block">
<div class="catListLink">
<h3 class="catListTitle">常用链接</h3>
<ul>
<li><a href="http://www.cnblogs.com/paddix/p/" title="我的博客的随笔列表">我的随笔</a></li><li><a href="http://www.cnblogs.com/paddix/MyComments.html" title="我发表过的评论列表">我的评论</a></li><li><a href="http://www.cnblogs.com/paddix/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li><li><a href="http://www.cnblogs.com/paddix/RecentComments.html" title="我的博客的评论列表">最新评论</a></li><li><a href="http://www.cnblogs.com/paddix/tag/" title="我的博客的标签列表">我的标签</a></li>
</ul>
<div id="itemListLin_con" style="display:none;">
<ul>

</ul>
</div>
</div></div><div id="sidebar_recentposts" class="sidebar-block">
<div class="catListEssay">
<h3 class="catListTitle">最新随笔</h3>
<ul>
<li><a href="http://www.cnblogs.com/paddix/p/5560933.html">1. Java集合类：AbstractCollection源码解析</a></li><li><a href="http://www.cnblogs.com/paddix/p/5539326.html">2. Java集合：整体结构</a></li><li><a href="http://www.cnblogs.com/paddix/p/5428507.html">3. Java 并发编程：volatile的使用及其原理</a></li><li><a href="http://www.cnblogs.com/paddix/p/5381958.html">4. Java 并发编程：线程间的协作(wait/notify/sleep/yield/join)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5405678.html">5. Java并发编程：Synchronized底层优化（偏向锁、轻量级锁）</a></li><li><a href="http://www.cnblogs.com/paddix/p/5367116.html">6. Java并发编程：Synchronized及其实现原理</a></li><li><a href="http://www.cnblogs.com/paddix/p/5374810.html">7. Java 并发编程：核心理论</a></li><li><a href="http://www.cnblogs.com/paddix/p/5326863.html">8. 通过反编译深入理解Java String及intern</a></li><li><a href="http://www.cnblogs.com/paddix/p/5309550.html">9. Java8内存模型—永久代(PermGen)和元空间(Metaspace)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5282004.html">10. 从字节码层面看“HelloWorld”</a></li>
</ul>
</div>
</div><div id="sidebar_toptags" class="sidebar-block">
<div class="catListTag">
<h3 class="catListTitle">我的标签</h3>
<ul>
<li><a href="http://www.cnblogs.com/paddix/tag/Java/">Java</a>(8)</li><li><a href="http://www.cnblogs.com/paddix/tag/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">并发编程</a>(4)</li><li><a href="http://www.cnblogs.com/paddix/tag/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/">集合框架</a>(1)</li><li><a href="http://www.cnblogs.com/paddix/tag/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/">类加载器</a>(1)</li><li><a href="http://www.cnblogs.com/paddix/tag/%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">内存模型</a>(1)</li><li><a href="http://www.cnblogs.com/paddix/tag/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE/">双亲委派</a>(1)</li><li><a href="http://www.cnblogs.com/paddix/tag/%E5%AD%97%E8%8A%82%E7%A0%81/">字节码</a>(1)</li><li><a href="http://www.cnblogs.com/paddix/tag/Java%208/">Java 8</a>(1)</li><li><a href="http://www.cnblogs.com/paddix/tag/JVM/">JVM</a>(1)</li><li><a href="http://www.cnblogs.com/paddix/tag/Lambda/">Lambda</a>(1)</li><li><a href="http://www.cnblogs.com/paddix/tag/">更多</a></li>
</ul>
</div></div><div id="sidebar_categories">
<div id="sidebar_postarchive" class="catListPostArchive sidebar-block">
<h3 class="catListTitle">随笔档案</h3>

<ul>

<li><a id="CatList_LinkList_0_Link_0" href="http://www.cnblogs.com/paddix/archive/2016/06.html">2016年6月 (1)</a> </li>

<li><a id="CatList_LinkList_0_Link_1" href="http://www.cnblogs.com/paddix/archive/2016/05.html">2016年5月 (3)</a> </li>

<li><a id="CatList_LinkList_0_Link_2" href="http://www.cnblogs.com/paddix/archive/2016/04.html">2016年4月 (4)</a> </li>

<li><a id="CatList_LinkList_0_Link_3" href="http://www.cnblogs.com/paddix/archive/2016/03.html">2016年3月 (3)</a> </li>

</ul>

</div>

</div><div id="sidebar_scorerank" class="sidebar-block">
<div class="catListBlogRank">
<h3 class="catListTitle">积分与排名</h3>
<ul>
	<li class="liScore">
		积分 -	18431
	</li>
	<li class="liRank">
		排名 -	12712
	</li>
</ul>
</div>


</div><div id="sidebar_recentcomments" class="sidebar-block"><div id="recent_comments_wrap">
<div class="catListComment">
<h3 class="catListTitle">最新评论</h3>

	<div id="RecentCommentsBlock"><ul>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/paddix/p/5326863.html#3505083">1. Re:通过反编译深入理解Java String及intern</a></li>
        <li class="recent_comment_body">#7应该是false吧，str2.intern()没有赋值给str2吧，str2指向的还是堆中的对象</li>
        <li class="recent_comment_author">--清殇煮雪</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/paddix/p/5560933.html#3493175">2. Re:Java集合类：AbstractCollection源码解析</a></li>
        <li class="recent_comment_body">@liuxiaopeng8G没错，但实际上它为了防止内存溢出，也仅仅只是作了这样一个限制MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8Integer.MAX_VALUE ......</li>
        <li class="recent_comment_author">--dracularking</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/paddix/p/5560933.html#3493115">3. Re:Java集合类：AbstractCollection源码解析</a></li>
        <li class="recent_comment_body">@dracularking1、Java中数组的最大长度是Integer.MAX_VALUE-2（最新1.8版本，每个版本有区别）2、存个这么长的数组是需要很大的内存的，如果这个数组存的是整数，占用的内......</li>
        <li class="recent_comment_author">--liuxiaopeng</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/paddix/p/5560933.html#3492215">4. Re:Java集合类：AbstractCollection源码解析</a></li>
        <li class="recent_comment_body">如果数组占据的容量达到了 Integer.MAX_VALUE + 8 ，就会导致OutOfMemoryError，不知道是什么原理</li>
        <li class="recent_comment_author">--dracularking</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/paddix/p/5381958.html#3492203">5. Re:Java 并发编程：线程间的协作(wait/notify/sleep/yield/join)</a></li>
        <li class="recent_comment_body">“我相信大家应该很容易知道wait等待其实是对象monitor，由于Java中的每一个对象都有一个内置的monitor对象，自然所有的类都理应有wait/notify方法。”我感觉这种设计从OOAD的......</li>
        <li class="recent_comment_author">--dracularking</li>
</ul>
</div>
</div>
</div></div><div id="sidebar_topviewedposts" class="sidebar-block"><div id="topview_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">阅读排行榜</h3>
	<div id="TopViewPostsBlock"><ul><li><a href="http://www.cnblogs.com/paddix/p/5282004.html">1. 从字节码层面看“HelloWorld”(3316)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5309550.html">2. Java8内存模型—永久代(PermGen)和元空间(Metaspace)(2398)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5367116.html">3. Java并发编程：Synchronized及其实现原理(2258)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5405678.html">4. Java并发编程：Synchronized底层优化（偏向锁、轻量级锁）(2168)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5374810.html">5. Java 并发编程：核心理论(2162)</a></li></ul></div>
</div>
</div></div><div id="sidebar_topcommentedposts" class="sidebar-block"><div id="topfeedback_posts_wrap">
<div class="catListFeedback">
<h3 class="catListTitle">评论排行榜</h3>
	<div id="TopFeedbackPostsBlock"><ul><li><a href="http://www.cnblogs.com/paddix/p/5282004.html">1. 从字节码层面看“HelloWorld”(8)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5326863.html">2. 通过反编译深入理解Java String及intern(8)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5381958.html">3. Java 并发编程：线程间的协作(wait/notify/sleep/yield/join)(7)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5428507.html">4. Java 并发编程：volatile的使用及其原理(6)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5367116.html">5. Java并发编程：Synchronized及其实现原理(5)</a></li></ul></div>
</div>
</div></div><div id="sidebar_topdiggedposts" class="sidebar-block"><div id="topdigg_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">推荐排行榜</h3>
<div id="TopDiggPostsBlock"><ul><li><a href="http://www.cnblogs.com/paddix/p/5282004.html">1. 从字节码层面看“HelloWorld”(24)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5374810.html">2. Java 并发编程：核心理论(12)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5560933.html">3. Java集合类：AbstractCollection源码解析(10)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5367116.html">4. Java并发编程：Synchronized及其实现原理(10)</a></li><li><a href="http://www.cnblogs.com/paddix/p/5381958.html">5. Java 并发编程：线程间的协作(wait/notify/sleep/yield/join)(8)</a></li></ul></div>
</div></div></div></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright ©2016 liuxiaopeng
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


</body></html>